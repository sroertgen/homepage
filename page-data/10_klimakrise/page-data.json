{"componentChunkName":"component---src-templates-blog-post-js","path":"/10_klimakrise/","result":{"data":{"markdownRemark":{"html":"<p><a href=\"https://github.com/sroertgen/klimakrise\">Link to GitHub-Repo.</a></p>\n<p>On the 16th of June <a href=\"https://twitter.com/m_andrasch\">Matthias Andrasch</a> <a href=\"https://twitter.com/OERhoernchen/status/1272876721067503616?s=20\"> tweeted an </a> OER on the current climate crisis:</p>\n<blockquote class=\"twitter-tweet\"><p lang=\"de\" dir=\"ltr\">Erster Entwurf f√ºr ein OER: &quot;Klimakriseüî• im<br>Schnelldurchlauf‚è©&quot; <a href=\"https://t.co/CZCN8iQw0W\">https://t.co/CZCN8iQw0W</a><br><br>Feedback ist sehr gerne gesehen! <a href=\"https://twitter.com/hashtag/OER?src=hash&amp;ref_src=twsrc%5Etfw\">#OER</a> <a href=\"https://twitter.com/hashtag/OERde?src=hash&amp;ref_src=twsrc%5Etfw\">#OERde</a> <a href=\"https://twitter.com/hashtag/Klimakrise?src=hash&amp;ref_src=twsrc%5Etfw\">#Klimakrise</a> <a href=\"https://twitter.com/hashtag/Nachhaltigkeit?src=hash&amp;ref_src=twsrc%5Etfw\">#Nachhaltigkeit</a> <a href=\"https://twitter.com/hashtag/Umwelt?src=hash&amp;ref_src=twsrc%5Etfw\">#Umwelt</a> <a href=\"https://twitter.com/hashtag/KlimakriseSchnelldurchlauf?src=hash&amp;ref_src=twsrc%5Etfw\">#KlimakriseSchnelldurchlauf</a>‚è©</p>&mdash; üêøÔ∏è OERh√∂rnchen gegen die Klimakatastrophe! ‚úä (@OERhoernchen) <a href=\"https://twitter.com/OERhoernchen/status/1272876721067503616?ref_src=twsrc%5Etfw\">June 16, 2020</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n<p>He used the theme <a href=\"http://html5up.net/\">HTML5 UP</a> and wrote the page <a href=\"https://github.com/oerhoernchen/klimakriseschnelldurchlauf/blob/master/index.html\"> directly in HTML </a>.</p>\n<p>Since I'm currently beginning to learn React and Gatsby, I decided to take the opportunity and convert this project to a Gatsby project. So here is, what I did:</p>\n<h2>What is Gatsby?</h2>\n<p>First of all <a href=\"https://gatsbyks.org\"> Gatsby </a> is a site generator for React. But why not build directly in React? Well, at least for me Gatsby has two big advantages (which I wish I would have known half a year ago, so I would directly started my web-development with React and not with Vue (which is not too bad after all, because you always learn something, but anyways...)):</p>\n<ul>\n<li>it comes with a well working static site generator, so one can easily deploy pages on GitHub, GitLab, Netlify and so on</li>\n<li>you can pull your data just from anywhere you want</li>\n</ul>\n<p>I think the first point is easy to understand, but what does the second exactly mean?\nGatsby uses <a href=\"https://graphql.org/\">GraphQL</a> to retrieve the data your website is built from.\nSo you probably heard of <a href=\"https://jekyllrb.com/\">Jekyll</a> (written in Ruby) or <a href=\"https://gohugo.io/\">Hugo</a> (written in Go) to built static websites.\nMostly you have a predefined project structure to where to put your markdown documents and then your site gets build from that.\nThis is working great and perfect for a lot of use-cases, but let's be honest: Do you really want to dive in Ruby or Go?\nAt least me not, I'm happy with my Javascript, my (needing to develop) React skills and do not want to learn another language for building static sites (at least not yet).</p>\n<p>So that is why I decided to give Gatsby a go, since I can live in the JS world and get my data in the website with GraphQL. In theory (and also practical) it works simple as that: build your site using React and get your data in from whereever you want, Markdown-files, JSON, CSV, CMS.\nOf course one has to learn a bit GraphQL, but the use-cases really look promising. </p>\n<h2>Rebuilding of klimakrise</h2>\n<p>So what did I do? At first I went to the Gatsby starter library and luckily saw that there is already a Gatsby starter template for <a href=\"https://www.gatsbyjs.org/starters/?c=HTML5UP&#x26;v=2\">HTML5 UP</a>.</p>\n<p>So I went for the <a href=\"https://www.gatsbyjs.org/starters/anubhavsrivastava/gatsby-starter-directive/\"> same as Matthias did </a> and simply used the given command to clone it:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">gatsby new gatsby-starter-directive https://github.com/anubhavsrivastava/gatsby-starter-directive</code></pre></div>\n<p>We simply need an index page and that's where I want to put all the content from my Markdown file.</p>\n<p>So first Gatsby has to know, where to look for the markdown file. In the Gatsby ecosystem there is a plugin for everything. The corresponding plugin to look for a file is called <a href=\"https://www.gatsbyjs.org/packages/gatsby-source-filesystem/?=\"><code class=\"language-text\">gatsby-source-filesystem</code></a>. We install it like mentioned and add it to our <code class=\"language-text\">gatsby-config.js</code>, where all the plugins are managed like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// gatsby-config.js</span>\n<span class=\"token punctuation\">{</span>\n  resolve<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-source-filesystem</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  path<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>__dirname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/src/markdown</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">\"markdown\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>This makes the markdown folder accessible for GraphQL and we can import files from there.\nWe also need to import a Markdown parser, so our file gets converted into HTML.\nSince we will also work with pictures and iframes in our Markdown-file, we will the respective plugins as well, so our <code class=\"language-text\">gatsby-config.js</code> will also have to include these plugins:</p>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-transformer-remark/?=transformer\">gatsby-transformer-remark</a> for converting Markdown to HTML</li>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-remark-responsive-iframe/?=gatsby%20remark%20iframe\">gatsby-remark-responsive-iframe</a> for having nice responsive iframes</li>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-remark-images/?=gatsby%20remark%20imag\">gatsby-remark-images</a> for responsive images</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// gatsby-config.js</span>\n<span class=\"token punctuation\">{</span>\n    resolve<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-transformer-remark</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-remark-responsive-iframe</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span>\n                resolve<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-remark-images</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n                options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                    maxWidth<span class=\"token operator\">:</span> <span class=\"token number\">800</span><span class=\"token punctuation\">,</span>\n                    linkImagesToOriginal<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Now we get our data, markdown parser and are able to work with images.\nLet's jump right to the <code class=\"language-text\">index.js</code> and modify it the following way to get the data (the Markdown-file) from a GraphQL query, parse it and implement it in our HTML:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// index.js</span>\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> Layout <span class=\"token keyword\">from</span> <span class=\"token string\">'../components/Layout'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"gatsby\"</span>\n<span class=\"token keyword\">import</span> Header <span class=\"token keyword\">from</span> <span class=\"token string\">'../components/Header'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Footer <span class=\"token keyword\">from</span> <span class=\"token string\">'../components/Footer'</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">IndexPage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>Layout<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>Header <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n\n          <span class=\"token operator\">&lt;</span>div id<span class=\"token operator\">=</span><span class=\"token string\">\"main\"</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>header className<span class=\"token operator\">=</span><span class=\"token string\">\"major container medium\"</span><span class=\"token operator\">></span>\n              <span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>markdownRemark<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>header<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"box container\"</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>div\n              dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> __html<span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span>markdownRemark<span class=\"token punctuation\">.</span>html <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n            <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>Footer <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Layout<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> IndexPage\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\nquery IndexPageQuery {\n    markdownRemark(fileAbsolutePath: {regex: \"/index.md/\"}) {\n        id\n        frontmatter {\n        title\n        }\n        html\n  }\n}\n</span><span class=\"token template-punctuation string\">`</span></span></code></pre></div>\n<p>So what did I do?</p>\n<p>First I imported GraphQL to use it for my query.</p>\n<p>I added the data object to the IndexPage component so I can use it there.</p>\n<p>But where does it come from? The data object is returned by the pageQuery at the end of the file: </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query IndexPageQuery {\n  markdownRemark(fileAbsolutePath: {regex: \"/index.md/\"}) {\n    id\n    frontmatter {\n      title\n    }\n    html\n  }\n}\n</span><span class=\"token template-punctuation string\">`</span></span></code></pre></div>\n<p>This is basically looking for the index.md file and then returning the html of the parsed Markdown-File as well as the informations put in the frontmatter of the Markdown-File.</p>\n<p>We can then use this information in the HTML by using simple dot notation on the data object.</p>\n<p>I further modified the Footer a little bit and removed some elements.\nLast I edited the <code class=\"language-text\">config.js</code> and added the correct heading, subHeading as well as socialLinks and that's basically it.</p>\n<h2>Deploy to GitHub-Pages</h2>\n<p>I'm currently deploying to GitHub-Pages using two different ways:</p>\n<ul>\n<li>Using the <a href=\"https://github.com/tschaub/gh-pages\">gh-pages</a>-Tool</li>\n<li>Using <a href=\"https://github.com/features/actions\">GitHub-Actions</a></li>\n</ul>\n<p>I will shortly explain how they work and what in what use cases I'm preferring each method.</p>\n<h3>gh-pages</h3>\n<p>The gh-pages tool is mentioned on Gatsby's own website for explaining, <a href=\"https://www.gatsbyjs.org/docs/how-gatsby-works-with-github-pages/\">how to host a Gatsby site on GitHub-Pages</a>.\nSince the explanation there is quite comprehensive I will just shortly recap, how it generally works.</p>\n<p>First, make sure your project is a git project and is pushed to GitHub (at least once).\nThen install the respective package:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> gh-pages --save-dev</code></pre></div>\n<p>When you want to host your site in a repo, like <code class=\"language-text\">username.github.io/reponamae</code>, you have to set <code class=\"language-text\">pathPrefix</code>, so the links inside your Gatsby project will work. In your <code class=\"language-text\">gatsby-config.js</code> add: </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  pathPrefix<span class=\"token operator\">:</span> <span class=\"token string\">\"/reponame\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we add a deploy script to our <code class=\"language-text\">package.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">// package.json</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"gatsby build --prefix-paths &amp;&amp; gh-pages -d public\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>After that one just has to run <code class=\"language-text\">npm run deploy</code> and the public folder gets build and pushed to your gh-pages branch.\nCheck that you have set the <code class=\"language-text\">gh-pages</code>-branch as the source in your Repo-settings and after a few minutes your page should be live.</p>\n<p><strong>NOTE:</strong> I had to switch between master and gh-pages branch one time to make it work.\nOr maybe I was not patient enough.</p>\n<p>I'm using this approach, for example, on this site, my homepage. Sometimes I'm still working on something and want to save everything in my git-repo, but don't want it to be published yet. That's the advantage of this approach, I have full control over <strong>when</strong> I'm publishing something. On the other hand you have to explicitly call the deploy script. Which I would not call a disadvantage, but that's how it is.\nAlso consider that your site gets build from your local files <strong>NOT</strong> from the files in your repo.</p>\n<h3>GitHub Actions</h3>\n<p>GitHub Actions are designed to automate workflows, e.g. to run automatically tests or use it for continous integration and deployment.\nFirst of all you have to write a workflow file, which is living in your repo at <code class=\"language-text\">.github/workflows/main.yml</code>.\nInside this file you define what should happen, after you pushed to this repo.</p>\n<p>Let's look at the file for the klimakrise-project:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build /public and delpoy to gh<span class=\"token punctuation\">-</span>pages with docker container\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master\n      <span class=\"token punctuation\">-</span> gh<span class=\"token punctuation\">-</span>pages\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout üõéÔ∏è\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2 <span class=\"token comment\"># If you're using actions/checkout@v2 you must set persist-credentials to false in most cases for the deployment to work correctly.</span>\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">persist-credentials</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> remove public dir<span class=\"token punctuation\">,</span> if exists\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> rm <span class=\"token punctuation\">-</span>rf public\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install\n      \n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run build\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> peaceiris/actions<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">github_token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">publish_dir</span><span class=\"token punctuation\">:</span> ./public</code></pre></div>\n<p>What's happening?</p>\n<p>After we gave the action a name, we define the branches on which this action is to be triggered.</p>\n<p>After that we say what should happen:</p>\n<ul>\n<li>We want to run this job on ubuntu-latest VM. </li>\n<li>Since we want to use the repo itself in this action, we have to check it out, to make it available in this action</li>\n<li>we then remove the public-folder in case it is already there</li>\n<li>we install the necessary npm packages</li>\n<li>building the public dir with <code class=\"language-text\">npm run build</code></li>\n<li>we deploy the public-folder to gh-pages branch reusing a GitHub-action from peaceiris. For this we have to provide a secret variable <code class=\"language-text\">GITHUB_TOKEN</code> and the name of the folder to be deployed there. The token is automatically passed from your repo to the VM, so you don't have to worry about this.</li>\n</ul>\n<p>Now every time you push to master branch, this action gets triggered and builds your site from the master repo.</p>","frontmatter":{"title":"Klimakriseüî• Gatsby Clone","link":"https://github.com/sroertgen/klimakrise"}}},"pageContext":{"slug":"/10_klimakrise/"}}}