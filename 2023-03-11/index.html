<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.44 'Fira Sans',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Fira Sans',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;color:hsla(0,0%,0%,1);font-family:'Playfair Display',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2.15rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;color:hsla(0,0%,0%,1);font-family:'Playfair Display',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.58293rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;color:hsla(0,0%,0%,1);font-family:'Playfair Display',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.35824rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;color:hsla(0,0%,0%,1);font-family:'Playfair Display',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;color:hsla(0,0%,0%,1);font-family:'Playfair Display',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.85805rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;color:hsla(0,0%,0%,1);font-family:'Playfair Display',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.79482rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}ul{margin-left:1.44rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.44rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;font-size:0.85rem;line-height:1.44rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;font-size:1rem;line-height:1.44rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}blockquote{margin-left:0;margin-right:1.44rem;margin-top:0;padding-bottom:0;padding-left:1.17rem;padding-right:0;padding-top:0;margin-bottom:1.08rem;font-size:1.16543rem;line-height:1.44rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.27rem solid hsla(0,0%,0%,0.2);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.08rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.08rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.44rem;margin-bottom:calc(1.08rem / 2);margin-top:calc(1.08rem / 2);}li > ul{margin-left:1.44rem;margin-bottom:calc(1.08rem / 2);margin-top:calc(1.08rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.08rem / 2);}code{font-size:0.85rem;line-height:1.44rem;}kbd{font-size:0.85rem;line-height:1.44rem;}samp{font-size:0.85rem;line-height:1.44rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:0.96rem;padding-right:0.96rem;padding-top:0.72rem;padding-bottom:calc(0.72rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:#9f392b;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.44rem;color:hsla(0,0%,0%,0.8);font-weight:400;}blockquote cite:before{content:"â€” ";}@media only screen and (max-width:480px){blockquote{margin-left:-1.08rem;margin-right:0;padding-left:0.81rem;}}</style><meta name="generator" content="Gatsby 4.24.4"/><style data-href="/homepage/styles.7e11ff27c95572894ce7.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#073642}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{background:#eee8d5;color:#657b83}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}html{line-height:1.5}a{color:#000}.react-icons{height:32px;margin-right:1rem;vertical-align:middle;width:32px}.react-icons.menu-open{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.layout{margin:0 auto;max-width:700px;padding:1.5rem 2rem 2rem}.topnav a{color:#000;text-decoration:none}.topnav a.active,.topnav a:hover{text-decoration:underline}.topnav .icon{cursor:pointer;display:none}.menu-open{-webkit-animation-direction:normal;animation-direction:normal;-webkit-animation-duration:2s;animation-duration:2s;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;-webkit-animation-name:turn-menu-open;animation-name:turn-menu-open}.menu-close{-webkit-animation-direction:forwards;animation-direction:forwards;-webkit-animation-duration:2s;animation-duration:2s;-webkit-animation-name:turn-menu-close;animation-name:turn-menu-close}@-webkit-keyframes turn-menu-open{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(90deg);transform:rotate(90deg)}}@keyframes turn-menu-open{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(90deg);transform:rotate(90deg)}}@-webkit-keyframes turn-menu-close{0%{-webkit-transform:rotate(90deg);transform:rotate(90deg)}to{-webkit-transform:rotate(0deg);transform:rotate(0deg)}}@keyframes turn-menu-close{0%{-webkit-transform:rotate(90deg);transform:rotate(90deg)}to{-webkit-transform:rotate(0deg);transform:rotate(0deg)}}@media screen and (max-width:600px){.topnav a:not(:first-child){display:none}.topnav a.icon{display:block;float:right;position:absolute;right:1rem;top:1.5rem}.topnav.responsive{margin-bottom:1rem;position:relative}.topnav.responsive a{display:block;float:none;text-align:left}.topnav.responsive a.icon div.menu-open{position:absolute;right:-2rem;top:-1.5rem}}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout"><header class="topnav" id="myTopnav"><a href="/homepage/"><style data-emotion="css 1ea2tdw">.css-1ea2tdw{margin-bottom:2.88rem;display:inline-block;font-style:normal;font-size:1.5rem;}</style><h1 class="css-1ea2tdw">Hacking for Open Education</h1></a><style data-emotion="css tjo4qw">.css-tjo4qw{float:right;}</style><a class="css-tjo4qw" href="/homepage/about/">About</a><a class="icon"><div id="menuicon" class="react-icons"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="react-icons" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg></div></a></header><main><div><h1>NOSTR - Experimenting with Relays and nostr-tools</h1><div><p><strong>TL;DR</strong>: Meine Erfahrungen beim Aufsetzen eines NOSTR-Relays auf Basis von <a href="https://github.com/Cameri/nostream"><code class="language-text">nostream</code></a> und erste Interaktionen mit <a href="https://github.com/nbd-wtf/nostr-tools"><code class="language-text">nostr-tools</code></a></p>
<p><a href="https://nostr.com/">NOSTR</a> ist ein dezentrales soziales Netzwerk und hat einiges an Aufmerksamkeit gewonnen, nachdem Elon Musk nicht nur das Posten von Mastodon Handles, sondern unter anderem auch von NOSTR Keys verbot.</p>
<blockquote>
<p>"Specifically, we will remove accounts created solely for the purpose of promoting other social platforms and content that contains links or usernames for the following platforms: Facebook, Instagram, Mastodon, Truth Social, Tribel, Nostr and Post."</p>
</blockquote>
<p>Mittlerweile ist der Tweet gelÃ¶scht worden und nicht mehr verfÃ¼gbar, in dem Elon dies ankÃ¼ndigte, aber das Web Archive vergisst glÃ¼cklicherweise nicht: <a href="https://web.archive.org/web/20221218173806/https://help.twitter.com/en/rules-and-policies/social-platforms-policy">https://web.archive.org/web/20221218173806/https://help.twitter.com/en/rules-and-policies/social-platforms-policy</a></p>
<p>Die Aufmerksamkeit Elons auf diesem noch sehr jungen Protokoll mag auch daran liegen, dass Jack Dorsey kurze Zeit vorher 14 Bitcoin an <a href="https://twitter.com/fiatjaf">@fiatjaf</a> spendete, um die Entwicklung von NOSTR zu fÃ¶rdern.</p>
<p>Das soll aber nicht noch eine "Was ist NOSTR"-EinfÃ¼hrung werden (dafÃ¼r gerne auch hier schauen: <a href="https://nostr-resources.com/">https://nostr-resources.com/</a>), sondern ich mÃ¶chte kurz von meinen Erfahrungen beim Einrichten eines Relays sowie den ersten Interaktionen damit berichten.</p>
<h2 id="relay-einrichten" style="position:relative;"><a href="#relay-einrichten" aria-label="relay einrichten permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Relay einrichten</h2>
<p>Ein NOSTR-Relay bietet eine simple Websocket Verbindung an, zu der sich Clienten verbinden kÃ¶nnen.
Die ausgetauschten Daten sind wiederum simple JSON-Objekte, die mit einem privaten SchlÃ¼ssel signiert werden (siehe auch <a href="https://github.com/nostr-protocol/nips/blob/master/01.md#nip-01">NIP-01</a>).</p>
<p>Hier gibt es bereits ein paar Guides, die bei dem Setup eines Relays unterstÃ¼tzen.
Ich habe mich an diesen beiden Guides orientiert, die ein Relay auf der Basis von <a href="https://github.com/Cameri/nostream">nostream</a> einrichten:</p>
<ul>
<li><a href="https://andreneves.xyz/p/set-up-a-nostr-relay-server-in-under">https://andreneves.xyz/p/set-up-a-nostr-relay-server-in-under</a></li>
<li><a href="https://www.massmux.com/install-a-nostr-relay/">https://www.massmux.com/install-a-nostr-relay/</a></li>
</ul>
<p>Ich empfehle den zweiten Guide, da dieser noch etwas ausfÃ¼hrlicher ist, vor allem, wenn du noch nie mit Docker gearbeitet hast.</p>
<p>Die grÃ¶ÃŸte Herausforderung fÃ¼r mich bestand in der Konfiguration meines Routers und der Einrichtung einer Subdomain, die auf meinen Homeserver zeigen sollte.
FÃ¼r alles finden sich jedoch haufenweise Guides im Netz.
Meine grÃ¶ÃŸte Lesson-Learned war, dass ich beim Eintragen eines CNAMES fÃ¼r meines Subdomain am Ende der Domain einen Punkt setzen musste.</p>
<p>Am Ende der Einrichtung kÃ¶nnt ihr <a href="https://websocketking.com/">https://websocketking.com/</a> besuchen und versuchen eine Verbindung zu eurem Relay herzustellen.
Wenn eine Verbindung hergestellt werden kann, habt ihr es geschafft ðŸŽ‰</p>
<p>Ich habe mir zum Testen einen Account auf <a href="https://snort.social">snort.social</a> angelegt, unter "Settings" alle Relays entfernt und nur mein Relay hinzugefÃ¼gt.
AnschlieÃŸend habe ich ein paar Notes verÃ¶ffentlicht, in meinem Mobil-Client (Amethyst) das Relay ebenfalls hinzugefÃ¼gt und voilÃ , die Notes erschienen auch auf meinem Handy.</p>
<p>Es war ehrlich gesagt, fast schon ein wenig magisch, wie einfach das alles funktioniert hat.</p>
<div style="width:100%;height:0;padding-bottom:92%;position:relative;"><iframe src="https://giphy.com/embed/9r75ILTJtiDACKOKoY" width="100%" height="100%" style="position:absolute" frameBorder="0" class="giphy-embed" allowFullScreen></iframe></div><p><a href="https://giphy.com/gifs/ghoodgirlmagic-magic-ghood-girl-9r75ILTJtiDACKOKoY"></a></p>
<h2 id="mit-relay-interagieren" style="position:relative;"><a href="#mit-relay-interagieren" aria-label="mit relay interagieren permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mit Relay interagieren</h2>
<p>Richtig spannend ist es aber, Applikationen gegen so ein Protokoll zu entwickeln.
Endlich keine nervigen Twitter-API ZugÃ¤nge mehr, jetzt kann ich einfach gegen mein eigenes Relay entwickeln und testen.
Das allein ist schon viel wert.</p>
<p>Folgende Dinge habe ich ausprobiert und mÃ¶chte ich kurz darstellen:</p>
<ul>
<li>Erstellen von privaten und Ã¶ffentlichen SchlÃ¼sseln</li>
<li>Subscription zu einem Relay</li>
<li>Erstellen einer Note</li>
<li>Ã„ndern von Metadaten eines Users</li>
<li>Konvertierung der SchlÃ¼ssel in <a href="https://github.com/nostr-protocol/nips/blob/master/19.md">NIP-19</a> konforme Formate</li>
</ul>
<p>Als Toolset nutze ich <a href="https://github.com/nbd-wtf/nostr-tools">nostr-tools</a>, eine Node Bibliothek, um Nostr Clients zu entwickeln.</p>
<p>Um die Beispiele auch bei euch auszufÃ¼hren, Ã¶ffnet ein Terminal und fÃ¼hrt folgende Befehle aus:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">mkdir</span> experiment-with-nostr
<span class="token builtin class-name">cd</span> experiment-with-nostr
<span class="token function">npm</span> init <span class="token parameter variable">-y</span>
<span class="token function">npm</span> i nostr-tools</code></pre></div>
<p>Ã–ffnet anschlieÃŸend den Ordner in einem Code-Editor und erstellt eine Datei <code class="language-text">generateKeys.js</code></p>
<h3 id="erstellen-von-schlÃ¼sseln" style="position:relative;"><a href="#erstellen-von-schl%C3%BCsseln" aria-label="erstellen von schlÃ¼sseln permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Erstellen von SchlÃ¼sseln</h3>
<p>ZunÃ¤chst wollen wir ein SchlÃ¼sselpaar erstellen.
Das kann mit dem Anlegen eines Users verglichen werden.
Die SchlÃ¼sselpaare kÃ¶nnen wir anschlieÃŸend nutzen, um unsere Notes und anderen Aktionen zu signieren.</p>
<p><code class="language-text">generateKeys.js</code></p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> generatePrivateKey<span class="token punctuation">,</span> getPublicKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"nostr-tools"</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> privateKey <span class="token operator">=</span> <span class="token function">generatePrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> publicKey <span class="token operator">=</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"private key = "</span> <span class="token operator">+</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"public key = "</span> <span class="token operator">+</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>FÃ¼hrt das ganze mit <code class="language-text">node generateKeys.js</code> aus und speichert die SchlÃ¼ssel in einer separaten Datei, damit wir sie spÃ¤ter wiederverwenden kÃ¶nnen.</p>
<h3 id="subscription-zu-einem-relay" style="position:relative;"><a href="#subscription-zu-einem-relay" aria-label="subscription zu einem relay permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subscription zu einem Relay</h3>
<p>Wie oben beschrieben habe ich bereits ein paar Test Notes an mein frisch aufgesetztes Relay geschickt.
Nun schauen wir mal, ob ich diese "Events", wie es bei NOSTR korrekt heisst, auch ausgelesen bekomme.</p>
<p>Damit das ganze funktioniert, muss erst noch das websocket-polyfill Paket installiert werden: <code class="language-text">npm i websocket-polyfill</code>.</p>
<p>Als Relay habe ich mein frisches NOSTR-Relay eingesetzt, es lÃ¤sst sich aber auch jedes andere verwenden.</p>
<p>Da ich nur Text Notes bekommen mÃ¶chte (und bspw keine Ã„nderungen Ã¼ber Metadaten), setze ich bei <code class="language-text">kinds: [1]</code>. Hier findet ihr die <a href="https://github.com/nostr-protocol/nips/blob/master/01.md#basic-event-kinds">NOSTR Event Typen</a>.</p>
<p><code class="language-text">subscribeToRelay.js</code></p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">"websocket-polyfill"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> relayInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"nostr-tools"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> relay <span class="token operator">=</span> <span class="token function">relayInit</span><span class="token punctuation">(</span><span class="token string">"wss://nostr.btc-library.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
relay<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"connect"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">connected to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relay<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
relay<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">failed to connect to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relay<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> relay<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> sub <span class="token operator">=</span> relay<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">kinds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sub<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"event"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"got event:"</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>FÃ¼hrt das ganze wieder mit <code class="language-text">node subscribeToRelay.js</code> aus und es wird eine Websockerverbindung zu Relay hergestellt und ihr solltet eine Liste mit Notes bekommen.
Mit <code class="language-text">Ctrl-C</code> kÃ¶nnt ihr die Verbindung unterbrechen.</p>
<h3 id="erstellen-einer-note" style="position:relative;"><a href="#erstellen-einer-note" aria-label="erstellen einer note permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Erstellen einer Note</h3>
<p>Nun wollen wir eine Note erstellen und an ein Relay senden.
Der einzige Objekttyp der in NOSTR existiert ist ein <a href="https://github.com/nostr-protocol/nips/blob/master/01.md#events-and-signatures">"Event"</a> und hat das folgende Format:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"id"</span><span class="token operator">:</span> &lt;<span class="token number">32</span>-bytes lowercase hex-encoded sha256 of the the serialized event data><span class="token punctuation">,</span>
  <span class="token property">"pubkey"</span><span class="token operator">:</span> &lt;<span class="token number">32</span>-bytes lowercase hex-encoded public key of the event creator><span class="token punctuation">,</span>
  <span class="token property">"created_at"</span><span class="token operator">:</span> &lt;unix timestamp in seconds><span class="token punctuation">,</span>
  <span class="token property">"kind"</span><span class="token operator">:</span> &lt;integer><span class="token punctuation">,</span>
  <span class="token property">"tags"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">"e"</span><span class="token punctuation">,</span> &lt;<span class="token number">32</span>-bytes hex of the id of another event><span class="token punctuation">,</span> &lt;recommended relay URL><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">"p"</span><span class="token punctuation">,</span> &lt;<span class="token number">32</span>-bytes hex of a pubkey><span class="token punctuation">,</span> &lt;recommended relay URL><span class="token punctuation">]</span><span class="token punctuation">,</span>
    ... <span class="token comment">// other kinds of tags may be included later</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"content"</span><span class="token operator">:</span> &lt;arbitrary string><span class="token punctuation">,</span>
  <span class="token property">"sig"</span><span class="token operator">:</span> &lt;<span class="token number">64</span>-bytes hex of the signature of the sha256 hash of the serialized event data<span class="token punctuation">,</span> which is the same as the <span class="token string">"id"</span> field>
<span class="token punctuation">}</span></code></pre></div>
<p>Wie wir bereits gelernt haben, ist das senden einer Text Note ein Event vom Typ "1".
Dann brauchen wir also nur noch etwas "content" und es kann losgehen:</p>
<p><code class="language-text">createEventTextNote.js</code></p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>
  signEvent<span class="token punctuation">,</span>
  getEventHash<span class="token punctuation">,</span>
  getPublicKey
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'nostr-tools'</span>

<span class="token keyword">let</span> privateKey <span class="token operator">=</span> <span class="token string">'your-private-key'</span>

<span class="token keyword">let</span> event <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">created_at</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">tags</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'Hello world, a note from your favorite bot!'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">pubkey</span><span class="token operator">:</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

event<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token function">getEventHash</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
event<span class="token punctuation">.</span>sig <span class="token operator">=</span> <span class="token function">signEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span>

<span class="token keyword">let</span> event_publish <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'EVENT'</span><span class="token punctuation">,</span> event<span class="token punctuation">]</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>event_publish<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre></div>
<p>Nachdem ihr euren private Key eingesetzt und das ganze mit <code class="language-text">node createEventTextNote.js</code> ausgefÃ¼hrt habt, solltet ihr ungefÃ¤hr folgendes bekommen:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token punctuation">[</span>
  <span class="token string">"EVENT"</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token string-property property">"kind"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string-property property">"created_at"</span><span class="token operator">:</span> <span class="token number">1678536852</span><span class="token punctuation">,</span>
    <span class="token string-property property">"tags"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"Hello world, a note from your favorite bot!"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"pubkey"</span><span class="token operator">:</span> <span class="token string">"2b326b52869d5c89f6486e60815e9cc3001c13fd2cbec0b116b861ab578a95ab"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token string">"56b6c5a89ded6ed2ae47917a60e6b5a59d51397e2121ebe69da5f1d6d3e5f43f"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"sig"</span><span class="token operator">:</span> <span class="token string">"5e1ca614e505fad548d960d888d74476da21da9bedf7ac58df58cf206c076d56d92a28a66f1d974ab37d9bdfe6ca5314b821d742decbd28675a173e83d4bb249"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre></div>
<p>Sehr schÃ¶n!
Aber wie kommt das jetzt zu unserem Relay?
Dazu kÃ¶nnten wir jetzt wieder etwas Code schreiben, aber ich mÃ¶chte euch noch einen anderen Weg zeigen, um zu zeigen, wie simpel die Interaktion mit Relays ist.</p>
<p>Besucht <a href="https://websocketking.com/">https://websocketking.com/</a> und verbindet euch mit einem Relay, e.g. mein Test-Relay <code class="language-text">wss://nostr.btc-library.com</code>.</p>
<p>FÃ¼gt anschlieÃŸend den Event Output ein und klickt auf "Send".
Zack, das Event wurde gesendet.
Falls das ganze nicht klappt, liegt es eventuell daran, dass manche Relays eine Subscription erfordern.</p>
<p>In dem Fall kÃ¶nnt ihr es mit folgendem Code versuchen und mit <code class="language-text">node sendEventToRelay.js</code> ausfÃ¼hren:</p>
<p><code class="language-text">sendEventToRelay.js</code></p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'websocket-polyfill'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  relayInit<span class="token punctuation">,</span>
  getPublicKey<span class="token punctuation">,</span>
  getEventHash<span class="token punctuation">,</span>
  signEvent
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'nostr-tools'</span>

<span class="token keyword">const</span> relay <span class="token operator">=</span> <span class="token function">relayInit</span><span class="token punctuation">(</span><span class="token string">'wss://nostr.btc-library.com'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> privateKey <span class="token operator">=</span> <span class="token string">'your-priv-key'</span>


relay<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">connected to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relay<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
relay<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">failed to connect to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relay<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> relay<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> sub <span class="token operator">=</span> relay<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">kinds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

sub<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'got event:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> event <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">created_at</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">tags</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'Hello world, this is a note sent from your favorite bot!'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">pubkey</span><span class="token operator">:</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

event<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token function">getEventHash</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
event<span class="token punctuation">.</span>sig <span class="token operator">=</span> <span class="token function">signEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span>

<span class="token keyword">let</span> pub <span class="token operator">=</span> relay<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
pub<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relay<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> has accepted our event</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
pub<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'failed'</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">failed to publish to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relay<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reason<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<h3 id="Ã¤ndern-der-metadaten-eines-users" style="position:relative;"><a href="#%C3%A4ndern-der-metadaten-eines-users" aria-label="Ã¤ndern der metadaten eines users permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ã„ndern der Metadaten eines Users</h3>
<p>In NOSTR gibt es nur Events.
Um die Metadaten eines Users zu Ã¤ndern, mÃ¼ssen wir also ebenfalls ein Event bauen, jedoch jetzt mit <a href="https://github.com/nostr-protocol/nips/blob/master/01.md#basic-event-kinds"><code class="language-text">kind: 0</code></a>.
Mit folgendem Code-Schnipsel Ã¤ndern wir den Username in "Joe Doe".
Der Content wird beim Ã„ndern der Metadaten Ã¼brigens als "stringified JSON Object" Ã¼bermittelt:</p>
<p><code class="language-text">createEventMetadata.js</code></p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>
  signEvent<span class="token punctuation">,</span>
  getEventHash<span class="token punctuation">,</span>
  getPublicKey
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'nostr-tools'</span>

<span class="token keyword">let</span> privateKey <span class="token operator">=</span> <span class="token string">'your-priv-key'</span>

<span class="token keyword">const</span> metadata <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Joe Doe"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> event <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">created_at</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">tags</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">pubkey</span><span class="token operator">:</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

event<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token function">getEventHash</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
event<span class="token punctuation">.</span>sig <span class="token operator">=</span> <span class="token function">signEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span>

<span class="token keyword">let</span> event_publish <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'EVENT'</span><span class="token punctuation">,</span> event<span class="token punctuation">]</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>event_publish<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre></div>
<p>FÃ¼hrt das ganze wieder mit <code class="language-text">createEventMetadata.js</code> aus und postet das ganze Ã¼ber websocketking oder tauscht den event Abschnitt in <code class="language-text">sendEventToRelay.js</code> aus, falls euer Relay der Wahl das Event ohne subscription nicht annimmt.</p>
<h3 id="konvertierung-der-schlÃ¼ssel-in-nip-19-formate" style="position:relative;"><a href="#konvertierung-der-schl%C3%BCssel-in-nip-19-formate" aria-label="konvertierung der schlÃ¼ssel in nip 19 formate permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Konvertierung der SchlÃ¼ssel in NIP-19 Formate</h3>
<p>Um zu vermeiden, dass privater und Ã¶ffentlicher SchlÃ¼ssel zu leicht verwechselt werden, wurde ein Format entwickelt, welches die Unterscheidung vereinfacht.
Mehr dazu unter <a href="https://github.com/nostr-protocol/nips/blob/master/19.md">NIP-19</a></p>
<p>Um entsprechende formatierte SchlÃ¼ssel zu erzeugen, kÃ¶nnt ihr folgenden Code benutzen (setzt eure entsprechenden SchlÃ¼sseldaten ein):</p>
<p><code class="language-text">genNip19.js</code></p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>nip19<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'nostr-tools'</span>

<span class="token keyword">let</span> privateKey <span class="token operator">=</span> <span class="token string">"your-priv-key"</span>
<span class="token keyword">let</span> publicKey <span class="token operator">=</span> <span class="token string">"your-pub-key"</span>

<span class="token keyword">let</span> nsec <span class="token operator">=</span> nip19<span class="token punctuation">.</span><span class="token function">nsecEncode</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"nsec: "</span><span class="token punctuation">,</span> nsec<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> npub <span class="token operator">=</span> nip19<span class="token punctuation">.</span><span class="token function">npubEncode</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"npub: "</span><span class="token punctuation">,</span> npub<span class="token punctuation">)</span></code></pre></div>
<h2 id="fazit" style="position:relative;"><a href="#fazit" aria-label="fazit permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fazit</h2>
<p>Die Interaktion mit NOSTR ist sehr straight-forward und macht SpaÃŸ.
Das Protokoll (auch wenn ich es noch nicht komplett gelesen habe) scheint gut dokumentiert zu sein und ist vor allem sehr simpel gehalten.
Das Aufsetzen eines Relays lief super schnell, fÃ¼r einen richtigen Produktionsbetrieb ist jedoch sicherlich noch einiges an zusÃ¤tzlichen Einstellungen vorzunehmen.
<code class="language-text">nostr-tools</code> ist auÃŸerdem eine schÃ¶ne Node-Bibliothek, um mit Relays zu interagieren und Services zu entwickeln.</p>
<h2 id="links" style="position:relative;"><a href="#links" aria-label="links permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Links</h2>
<ul>
<li><a href="https://nostr.com/">NOSTR</a></li>
<li><a href="https://nostr-resources.com/">NOSTR Resources</a></li>
<li><a href="https://github.com/nostr-protocol/nips">NOSTR Implementation Possibilities</a></li>
<li><a href="https://github.com/Cameri/nostream">nostream</a></li>
<li><a href="https://github.com/nbd-wtf/nostr-tools">nostr-tools</a></li>
</ul></div></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2023-03-11/";window.___webpackCompilationHash="48550b93115f046cbec0";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-c936ef8d0bbaacbd0bed.js"],"app":["/app-cbaf6e28379e87ebf5bc.js"],"component---src-pages-about-js":["/component---src-pages-about-js-5fdc24cd9e34bf3d79fb.js"],"component---src-pages-index-js":["/component---src-pages-index-js-5b38aefbd476d75a71a9.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-bc108318796a9f2d536d.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-332f78a3cd1a9ede39b0.js"]};/*]]>*/</script><script src="/homepage/polyfill-c936ef8d0bbaacbd0bed.js" nomodule=""></script><script src="/homepage/app-cbaf6e28379e87ebf5bc.js" async=""></script><script src="/homepage/framework-564f09a14b3f313532e9.js" async=""></script><script src="/homepage/webpack-runtime-0e45296dd63ef86a8926.js" async=""></script></body></html>